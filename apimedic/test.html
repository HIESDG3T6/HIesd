<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">

    <title>Symptoms</title>

    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- Bootstrap libraries -->
    <meta name="viewport" 
        content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
    integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" 
    crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script 
    src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <script
    src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>

    <script src="js/hmac-md5.js"></script>                        
    <script src="js/enc-base64-min.js"></script>
    <script>
        var uri = "https://sandbox-authservice.priaid.ch/login";
        var secret_key = "mysecretkey";
        var computedHash = CryptoJS.HmacMD5(uri, secret_key);
        var computedHashString = computedHash.toString(CryptoJS.enc.Base64);     
          console.log('tail');
            // var serviceURL = "https://sandbox-authservice.priaid.ch/login" + "/" + isbnNumber;
            try {
                let response = fetch('https://sandbox-authservice.priaid.ch/login?format=json', {
                    method: 'POST',
                    headers: {
                        'Host': 'authservice.priaid.ch',
                        'Authorization': "Bearer huifen.ong.2018@smu.edu.sg: " + computedHashString
                    },
                });
                const data = response.json();
                const token = data.Token();
                console.log(response);
            }
            catch (error) {
                // Errors when calling the service; such as network error, 
                // service offline, etc
                // showError
              ('There is a problem retrieving books data, please try again later.<br />'+error);
               
            }
          
    </script>


</head>
<body>
  <div id="symptomchecker" class="container">
    <form id="symptomsForm">
      Year of Birth <input name="yearofbirth" type="text" id="yearofbirth" class="form-control" required><br><br>

      Gender:
      <input type="radio" id="gender" name="gender" value="Male" required>Male</input>
      <input type="radio" id="gender" name="gender" value="Female" required>Female</input><br><br>

      Select symptoms:
      <select name='symptoms' id="symptom" class="form-control" multiple>
          <script>
            console.log('1');
              async function getSymptoms() {
                // console.log('2');
                // var serviceURL = "https://sandbox-authservice.priaid.ch/login" + "/" + isbnNumber;
                try {
                    var serviceURL = 'https://sandbox-authservice.priaid.ch/symptoms?token=' + token + '&language=en-gb';
                    const response =
                    await fetch(
                      serviceURL, { method: 'GET' }
                    );
                    const data = await response.json();
                    // var books = data.books; //the arr is in data.books of the JSON data
                    console.log(response);
                    // array or array.length are falsy
                    if (response.ok) {
                        console.log(data);
                        // for loop to setup all table rows with obtained book data
                        var rows = "";
                            eachRow =
                                "<option id='data.ID'>" + data.Name + "</option>";
                            rows += eachRow;
                        // add all the rows to the table
                        $('#symptoms').append(rows);
                    } 

                    // console.log(response);
                }
            catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                  console.log('error');
                    showError
                  ('There is a problem retrieving books data, please try again later.<br />'+error);
                  
                }
    }
          </script>
        <!-- <?php
          $symptomlist = $Symptoms->diagnosisClient->loadSymptoms();
          // var_dump($bodyLocations);
          foreach ($symptomlist as $aSymptom){
            $id = $aSymptom['ID'];
            $symptomName = $aSymptom['Name'];
            
            echo "<option value=$id>$symptomName</option>";
          }

          
        ?> -->
      </select>

      <!-- <?php

          // $test = $Symptoms->diagnosisClient->loadDiagnosis([16], 'male', 2009);

          // var_dump($test);
      ?> -->
      <button id="searchBtn" type="button" class="btn btn-primary" > Submit </button>
    </form>
    <!-- <table id="resultsTable" class='table table-striped' border='1'>
        <thead class='thead-dark'>
            <tr>
                <th>Title</th>
                <th>ISBN 13</th>
                <th>Price</th>
                <th>Availability</th>
            </tr>
        </thead>
    </table> -->
  </div>


  <script>
    // $('#resultsTable').hide();
    // // Helper function to display error message
    // function showError(message) {
    //     // Hide the table and button in the event of error
    //     $('#resultsTable').hide();

    //     // Display an error under the main container
    //     $('#symptomchecker')
    //         .append("<label>"+message+"</label>");
    // }
    // $("#searchBtn").submit(async (event) => {

      console.log('hello');
    $('#searchBtn').click(async(event) => {  
    //Prevents screen from refreshing when submitting  
        event.preventDefault();

        var yearofbirth = $('#yearofbirth').val();
        var gender = $('#gender').val();
        var symptom = $('#symptom').val();

        const diagnosis = 
        console.log(diagnosis);
        try {
            // const response =
            // await fetch(
            //     serviceURL, { method: 'GET' }
            // );
            const data = await diagnosis.json();
            // var books = data.books; //the arr is in data.books of the JSON data

            // array or array.length are falsy
            if (response.ok) {
                console.log(data);
                // for loop to setup all table rows with obtained book data
                // var rows = "";
                //     eachRow =
                //         "<td>" + data.title + "</td>" +
                //         "<td>" + data.isbn13 + "</td>" +
                //         "<td>" + data.price + "</td>" +
                //         "<td>" + data.availability + "</td>";
                //     rows += "<tbody><tr>" + eachRow + "</tr></tbody>";
                // // add all the rows to the table
                // $('#booksTable').append(rows);
                // $('#booksTable').show();
            } 
        } catch (error) {
            // Errors when calling the service; such as network error, 
            // service offline, etc
            showError
          ('There is a problem retrieving books data, please try again later.<br />'+error);
            
        } // error
    });

  </script>


</body>
</html>